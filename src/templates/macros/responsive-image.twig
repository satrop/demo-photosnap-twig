{# 
  Responsive Image Macro
  @param {string} imagePath - The full path to the desktop version of the image
  @param {string} alt - Alt text for the image
  @param {string} className - Optional CSS class name(s)
  @param {boolean} decorative - If true, image is decorative and alt text will be empty
  @param {boolean} ariaHidden - If true, adds aria-hidden="true"
#}

{% macro responsiveImage(imagePath, alt, className = '', decorative = false, ariaHidden = false) %}
    {# Handle path construction #}
    {% set parts = imagePath|split('/') %}
    {% set filename = parts|last|replace({'.jpg': '', '.webp': ''}) %}
    {% set parts = parts[:-1] %}
    {% set basePath = parts|join('/') %}
    
    {# Handle GitHub Pages base path #}
    {% set prefix = is_github_pages ? base_path : '' %}
    
    <picture>
        {# Mobile WebP #}
        <source
            srcset="{{ prefix }}/images/stories/mobile/{{ filename }}.webp"
            media="(max-width: 767px)"
            type="image/webp"
        >
        {# Mobile JPG fallback #}
        <source
            srcset="{{ prefix }}/images/stories/mobile/{{ filename }}.jpg"
            media="(max-width: 767px)"
            type="image/jpeg"
        >
        {# Tablet WebP #}
        {# <source
            srcset="{{ prefix }}/images/stories/tablet/{{ filename }}.webp"
            media="(max-width: 1023px)"
            type="image/webp"
        > #}
        {# Tablet JPG fallback #}
        {# <source
            srcset="{{ prefix }}/images/stories/tablet/{{ filename }}.jpg"
            media="(max-width: 1023px)"
            type="image/jpeg"
        > #}
        {# Desktop WebP #}
        <source
            srcset="{{ prefix }}/images/stories/desktop/{{ filename }}.webp"
            type="image/webp"
        >
        {# Desktop JPG fallback #}
        <img 
            src="{{ prefix }}/images/stories/desktop/{{ filename }}.jpg"
            alt="{{ decorative ? '' : alt }}"
            class="{{ className }}"
            {{ ariaHidden ? 'aria-hidden="true"' : '' }}
        >
    </picture>
{% endmacro %}


